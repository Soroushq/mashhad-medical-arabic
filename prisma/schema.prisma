// File: prisma/schema.prisma
generator client {
  provider   = "prisma-client-js"
  engineType = "library"
}

datasource db {
  provider = "mysql"
}

enum Role {
  SUPER_ADMIN
  ADMIN
  EDITOR
  VIEWER
}

model User {
  id            Int           @id @default(autoincrement())
  username      String        @unique
  password      String
  name          String
  role          Role          @default(VIEWER)
  isActive      Boolean       @default(true)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  reviewReplies ReviewReply[]
}

model Category {
  id        Int      @id @default(autoincrement())
  nameAr    String
  nameEn    String?
  icon      String
  slug      String   @unique
  doctors   Doctor[]
  createdAt DateTime @default(now())
}

model Doctor {
  id          Int          @id @default(autoincrement())
  nameAr      String
  nameEn      String?
  titleAr     String
  titleEn     String?
  bioAr       String       @db.Text
  bioEn       String?      @db.Text
  phone       String
  whatsapp    String
  imageUrl    String?
  rating      Float        @default(5.0)
  experience  Int
  locationAr  String
  locationEn  String?
  categoryId  Int
  category    Category     @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  reviews     Review[]
  likes       DoctorLike[]
  likesCount  Int          @default(0)
  viewsCount  Int          @default(0)
  isActive    Boolean      @default(true)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
}

model Review {
  id          Int           @id @default(autoincrement())
  userName    String
  userEmail   String?
  rating      Int
  comment     String?       @db.Text
  doctorId    Int
  doctor      Doctor        @relation(fields: [doctorId], references: [id], onDelete: Cascade)
  isApproved  Boolean       @default(false)
  replies     ReviewReply[]
  createdAt   DateTime      @default(now())
}

model ReviewReply {
  id        Int      @id @default(autoincrement())
  reviewId  Int
  review    Review   @relation(fields: [reviewId], references: [id], onDelete: Cascade)
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  message   String   @db.Text
  createdAt DateTime @default(now())
}

model DoctorLike {
  id        Int      @id @default(autoincrement())
  doctorId  Int
  doctor    Doctor   @relation(fields: [doctorId], references: [id], onDelete: Cascade)
  ipAddress String
  createdAt DateTime @default(now())

  @@unique([doctorId, ipAddress])
}

model Analytics {
  id             Int      @id @default(autoincrement())
  date           DateTime @default(now()) @db.Date
  pageViews      Int      @default(0)
  uniqueVisitors Int      @default(0)
  doctorViews    Int      @default(0)
  searches       Int      @default(0)
  reviews        Int      @default(0)

  @@unique([date])
}

// Tourist Attractions Feature
enum PriceRange {
  FREE          // مجاني
  BUDGET        // اقتصادي
  MODERATE      // متوسط
  EXPENSIVE     // مرتفع
  VERY_EXPENSIVE // مرتفع جداً
}

model AttractionCategory {
  id          Int          @id @default(autoincrement())
  nameAr      String
  nameEn      String?
  icon        String
  slug        String       @unique
  isActive    Boolean      @default(false) // Admin activates categories
  
  // SEO Fields
  seoTitle       String?
  seoDescription String?    @db.Text
  seoKeywords    String?
  
  attractions Attraction[]
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
}

model Attraction {
  id             Int                @id @default(autoincrement())
  nameAr         String
  nameEn         String?
  descriptionAr  String             @db.Text
  descriptionEn  String?            @db.Text
  
  // Category
  categoryId     Int
  category       AttractionCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  
  // Contact & Location
  address        String
  phone          String?
  whatsapp       String?
  website        String?
  mapLink        String?            // Google Maps share link
  mapImageUrl    String?            // Screenshot of map location
  
  // Media - Multiple images stored as JSON array
  images         String             @default("[]") @db.Text // ["url1", "url2", "url3"]
  
  // Pricing & Time
  priceRange     PriceRange?
  openingHours   String?
  
  // Engagement
  rating         Float              @default(0)
  likesCount     Int                @default(0)
  viewsCount     Int                @default(0)
  isActive       Boolean            @default(true)
  isFeatured     Boolean            @default(false)
  
  // SEO Fields
  seoTitle       String?
  seoDescription String?            @db.Text
  seoKeywords    String?
  slug           String             @unique
  
  reviews        AttractionReview[]
  likes          AttractionLike[]
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt
}

model AttractionReview {
  id           Int        @id @default(autoincrement())
  attractionId Int
  attraction   Attraction @relation(fields: [attractionId], references: [id], onDelete: Cascade)
  userName     String
  userEmail    String?
  rating       Int        // 1-5
  comment      String?    @db.Text
  isApproved   Boolean    @default(false)
  createdAt    DateTime   @default(now())
}

model AttractionLike {
  id           Int        @id @default(autoincrement())
  attractionId Int
  attraction   Attraction @relation(fields: [attractionId], references: [id], onDelete: Cascade)
  ipAddress    String
  createdAt    DateTime   @default(now())

  @@unique([attractionId, ipAddress])
}
